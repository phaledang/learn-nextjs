# Next.js Syntax Reference

## Table of Contents
1. [Project Structure](#project-structure)
2. [Pages and Routing](#pages-and-routing)
3. [Layouts](#layouts)
4. [Metadata](#metadata)
5. [Server vs Client Components](#server-vs-client-components)
6. [Data Fetching](#data-fetching)
7. [Navigation](#navigation)
8. [Configuration](#configuration)

---

## Project Structure

### App Router Structure (Next.js 14)

```
app/
├── layout.tsx          # Root layout
├── page.tsx            # Home page (/)
├── loading.tsx         # Loading UI
├── error.tsx           # Error UI
├── not-found.tsx       # 404 page
├── globals.css         # Global styles
├── about/
│   └── page.tsx        # About page (/about)
├── blog/
│   ├── page.tsx        # Blog list (/blog)
│   └── [slug]/
│       └── page.tsx    # Blog post (/blog/post-title)
└── api/
    └── route.ts        # API endpoint (/api)
```

### Key Files

- **page.tsx**: Defines a route's UI
- **layout.tsx**: Shared UI for segments and their children
- **loading.tsx**: Loading UI for segments
- **error.tsx**: Error UI for segments
- **not-found.tsx**: 404 UI for segments

---

## Pages and Routing

### Basic Page

```typescript
// app/page.tsx
export default function Page() {
  return <h1>Hello, Next.js!</h1>
}
```

### Page with TypeScript

```typescript
// app/page.tsx
export default function Page(): JSX.Element {
  return (
    <div>
      <h1>Welcome</h1>
      <p>This is a typed page</p>
    </div>
  )
}
```

### Nested Routes

```typescript
// app/blog/page.tsx
export default function BlogPage() {
  return <h1>Blog</h1>
}

// Creates route: /blog
```

### Dynamic Routes

```typescript
// app/blog/[slug]/page.tsx
export default function BlogPost({ 
  params 
}: { 
  params: { slug: string } 
}) {
  return <h1>Post: {params.slug}</h1>
}

// Matches: /blog/hello-world, /blog/my-post, etc.
```

### Multiple Dynamic Segments

```typescript
// app/shop/[category]/[product]/page.tsx
export default function Product({ 
  params 
}: { 
  params: { category: string; product: string } 
}) {
  return (
    <div>
      <h1>Category: {params.category}</h1>
      <h2>Product: {params.product}</h2>
    </div>
  )
}

// Matches: /shop/electronics/laptop
```

### Catch-all Routes

```typescript
// app/docs/[...slug]/page.tsx
export default function Docs({ 
  params 
}: { 
  params: { slug: string[] } 
}) {
  return <h1>Docs: {params.slug.join('/')}</h1>
}

// Matches: /docs/a, /docs/a/b, /docs/a/b/c
```

### Optional Catch-all Routes

```typescript
// app/docs/[[...slug]]/page.tsx
export default function Docs({ 
  params 
}: { 
  params: { slug?: string[] } 
}) {
  return <h1>Docs: {params.slug?.join('/') || 'Home'}</h1>
}

// Matches: /docs, /docs/a, /docs/a/b
```

---

## Layouts

### Root Layout (Required)

```typescript
// app/layout.tsx
import type { Metadata } from 'next'
import './globals.css'

export const metadata: Metadata = {
  title: 'My App',
  description: 'Generated by create next app',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  )
}
```

### Nested Layout

```typescript
// app/blog/layout.tsx
export default function BlogLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <div>
      <nav>Blog Navigation</nav>
      <main>{children}</main>
    </div>
  )
}
```

### Layout with Header and Footer

```typescript
// app/layout.tsx
import Header from './components/Header'
import Footer from './components/Footer'

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body>
        <Header />
        <main>{children}</main>
        <Footer />
      </body>
    </html>
  )
}
```

---

## Metadata

### Static Metadata

```typescript
// app/page.tsx
import type { Metadata } from 'next'

export const metadata: Metadata = {
  title: 'My Page',
  description: 'Page description',
}

export default function Page() {
  return <h1>Page</h1>
}
```

### Dynamic Metadata

```typescript
// app/blog/[slug]/page.tsx
import type { Metadata } from 'next'

type Props = {
  params: { slug: string }
}

export async function generateMetadata({ params }: Props): Promise<Metadata> {
  return {
    title: `Blog Post: ${params.slug}`,
    description: `Read about ${params.slug}`,
  }
}

export default function BlogPost({ params }: Props) {
  return <h1>{params.slug}</h1>
}
```

### Metadata Object Properties

```typescript
export const metadata: Metadata = {
  title: 'My Page',
  description: 'Description',
  keywords: ['next.js', 'react', 'typescript'],
  authors: [{ name: 'Your Name' }],
  creator: 'Your Name',
  publisher: 'Your Company',
  openGraph: {
    title: 'My Page',
    description: 'Description',
    url: 'https://example.com',
    siteName: 'My Site',
    images: [
      {
        url: 'https://example.com/og.png',
        width: 800,
        height: 600,
      },
    ],
    type: 'website',
  },
  twitter: {
    card: 'summary_large_image',
    title: 'My Page',
    description: 'Description',
    images: ['https://example.com/twitter.png'],
  },
  robots: {
    index: true,
    follow: true,
  },
}
```

---

## Server vs Client Components

### Server Component (Default)

```typescript
// app/components/ServerComponent.tsx
// No 'use client' directive = Server Component

export default function ServerComponent() {
  return (
    <div>
      <h1>I'm a Server Component</h1>
      <p>I run on the server and can't use hooks</p>
    </div>
  )
}
```

### Client Component

```typescript
// app/components/ClientComponent.tsx
'use client'

import { useState } from 'react'

export default function ClientComponent() {
  const [count, setCount] = useState(0)

  return (
    <div>
      <h1>I'm a Client Component</h1>
      <p>Count: {count}</p>
      <button onClick={() => setCount(count + 1)}>
        Increment
      </button>
    </div>
  )
}
```

### Server Component with Data Fetching

```typescript
// app/components/Posts.tsx
async function getPosts() {
  const res = await fetch('https://api.example.com/posts')
  return res.json()
}

export default async function Posts() {
  const posts = await getPosts()

  return (
    <ul>
      {posts.map((post: any) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  )
}
```

### When to Use Each

**Server Components (Default):**
- Fetch data
- Access backend resources directly
- Keep sensitive information on server
- Keep large dependencies on server
- Reduce JavaScript bundle size

**Client Components ('use client'):**
- Add interactivity (onClick, onChange, etc.)
- Use React hooks (useState, useEffect, etc.)
- Use browser APIs (localStorage, etc.)
- Use class components

---

## Data Fetching

### Async Server Component

```typescript
// app/posts/page.tsx
async function getPosts() {
  const res = await fetch('https://api.example.com/posts')
  
  if (!res.ok) {
    throw new Error('Failed to fetch posts')
  }
  
  return res.json()
}

export default async function PostsPage() {
  const posts = await getPosts()

  return (
    <ul>
      {posts.map((post: any) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  )
}
```

### Fetch with Caching

```typescript
// Cache for 1 hour
async function getData() {
  const res = await fetch('https://api.example.com/data', {
    next: { revalidate: 3600 }
  })
  return res.json()
}
```

### No Caching

```typescript
// Always fetch fresh data
async function getData() {
  const res = await fetch('https://api.example.com/data', {
    cache: 'no-store'
  })
  return res.json()
}
```

### Parallel Data Fetching

```typescript
async function getUser(id: string) {
  const res = await fetch(`https://api.example.com/users/${id}`)
  return res.json()
}

async function getPosts(userId: string) {
  const res = await fetch(`https://api.example.com/posts?userId=${userId}`)
  return res.json()
}

export default async function Page({ params }: { params: { id: string } }) {
  // Parallel fetching
  const [user, posts] = await Promise.all([
    getUser(params.id),
    getPosts(params.id)
  ])

  return (
    <div>
      <h1>{user.name}</h1>
      <ul>
        {posts.map((post: any) => (
          <li key={post.id}>{post.title}</li>
        ))}
      </ul>
    </div>
  )
}
```

---

## Navigation

### Link Component

```typescript
import Link from 'next/link'

export default function Navigation() {
  return (
    <nav>
      <Link href="/">Home</Link>
      <Link href="/about">About</Link>
      <Link href="/blog">Blog</Link>
    </nav>
  )
}
```

### Link with Dynamic Route

```typescript
import Link from 'next/link'

export default function PostsList({ posts }: { posts: any[] }) {
  return (
    <ul>
      {posts.map((post) => (
        <li key={post.id}>
          <Link href={`/blog/${post.slug}`}>
            {post.title}
          </Link>
        </li>
      ))}
    </ul>
  )
}
```

### Programmatic Navigation (Client Component)

```typescript
'use client'

import { useRouter } from 'next/navigation'

export default function Button() {
  const router = useRouter()

  return (
    <button onClick={() => router.push('/about')}>
      Go to About
    </button>
  )
}
```

### useRouter Methods

```typescript
'use client'

import { useRouter } from 'next/navigation'

export default function Component() {
  const router = useRouter()

  // Navigate to a route
  router.push('/dashboard')
  
  // Replace current route
  router.replace('/login')
  
  // Refresh the current route
  router.refresh()
  
  // Go back
  router.back()
  
  // Go forward
  router.forward()
}
```

---

## Configuration

### next.config.js

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  // Enable React strict mode
  reactStrictMode: true,
  
  // Configure images
  images: {
    domains: ['example.com'],
  },
  
  // Environment variables
  env: {
    CUSTOM_KEY: 'my-value',
  },
  
  // Redirects
  async redirects() {
    return [
      {
        source: '/old-blog/:slug',
        destination: '/blog/:slug',
        permanent: true,
      },
    ]
  },
  
  // Rewrites
  async rewrites() {
    return [
      {
        source: '/api/:path*',
        destination: 'https://api.example.com/:path*',
      },
    ]
  },
}

module.exports = nextConfig
```

### Environment Variables

```bash
# .env.local
DATABASE_URL="postgresql://..."
NEXT_PUBLIC_API_URL="https://api.example.com"
```

```typescript
// Access in server components
const dbUrl = process.env.DATABASE_URL

// Access in client components (must start with NEXT_PUBLIC_)
const apiUrl = process.env.NEXT_PUBLIC_API_URL
```

---

## Loading States

### Loading UI

```typescript
// app/loading.tsx
export default function Loading() {
  return <div>Loading...</div>
}
```

### Suspense

```typescript
import { Suspense } from 'react'

export default function Page() {
  return (
    <div>
      <h1>Page Title</h1>
      <Suspense fallback={<div>Loading posts...</div>}>
        <Posts />
      </Suspense>
    </div>
  )
}
```

---

## Error Handling

### Error Boundary

```typescript
// app/error.tsx
'use client'

export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string }
  reset: () => void
}) {
  return (
    <div>
      <h2>Something went wrong!</h2>
      <p>{error.message}</p>
      <button onClick={() => reset()}>Try again</button>
    </div>
  )
}
```

### Not Found Page

```typescript
// app/not-found.tsx
export default function NotFound() {
  return (
    <div>
      <h2>Not Found</h2>
      <p>Could not find requested resource</p>
    </div>
  )
}
```

---

## Common Patterns

### Component with Props

```typescript
interface CardProps {
  title: string
  description: string
  children?: React.ReactNode
}

export default function Card({ title, description, children }: CardProps) {
  return (
    <div>
      <h2>{title}</h2>
      <p>{description}</p>
      {children}
    </div>
  )
}
```

### Conditional Rendering

```typescript
export default function Component({ isLoggedIn }: { isLoggedIn: boolean }) {
  return (
    <div>
      {isLoggedIn ? (
        <p>Welcome back!</p>
      ) : (
        <p>Please log in</p>
      )}
    </div>
  )
}
```

### List Rendering

```typescript
interface Item {
  id: number
  name: string
}

export default function List({ items }: { items: Item[] }) {
  return (
    <ul>
      {items.map((item) => (
        <li key={item.id}>{item.name}</li>
      ))}
    </ul>
  )
}
```

---

## Build Commands

```bash
# Development server
npm run dev

# Production build
npm run build

# Start production server
npm start

# Lint code
npm run lint
```

---

## Quick Tips

1. **Server Components by default**: Don't add `'use client'` unless you need interactivity
2. **Use TypeScript**: Better developer experience and fewer bugs
3. **Leverage file-based routing**: No need to configure routes
4. **Metadata is important**: Always add proper metadata for SEO
5. **Use Link for navigation**: Better performance than `<a>` tags
6. **Fetch data in Server Components**: Keep client bundle small
7. **Use loading.tsx**: Provide loading states automatically
8. **Use error.tsx**: Handle errors gracefully

---

This reference covers the essential Next.js syntax and patterns. Refer back to this document as you build your applications!
